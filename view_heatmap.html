<!DOCTYPE html>
<html>
<head>
    <title>Florida Population Growth Forecast</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .control-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .layer-toggles {
            display: flex;
            gap: 15px;
        }
        
        .toggle-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .toggle-btn.active {
            background: #27ae60;
        }
        
        .toggle-btn.active::before {
            content: '‚úì ';
        }
        
        .map-container {
            position: relative;
            height: calc(100vh - 250px);
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #map { 
            height: 100%;
            width: 100%;
        }
        
        .legend {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            line-height: 2;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .legend h4 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 700;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 5px;
            margin-right: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .gto-indicator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px 50px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 10000;
            font-size: 18px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .leaflet-popup-content {
            margin: 15px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .leaflet-popup-content strong {
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå¥ Florida GTO Triangle Olympic Bid Analysis</h1>
            <p>10-Year Population Growth & Infrastructure (2035-2045)</p>
            
            <div class="controls">
                <div class="control-group">
                    <div class="control-label">Map Layers</div>
                    <div class="layer-toggles">
                        <button class="toggle-btn active" onclick="toggleLayer('heatmap')">üî• Growth Heatmap</button>
                        <button class="toggle-btn" onclick="toggleLayer('airports')">‚úàÔ∏è Airports</button>
                        <button class="toggle-btn" onclick="toggleLayer('stadiums')">üèüÔ∏è Stadiums</button>
                        <button class="toggle-btn" onclick="toggleLayer('universities')">üéì Universities</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="loading" id="loading">Loading data</div>
        </div>
    </div>
    
    <script>
        let map;
        let heatmapLayer = null;
        let countyMarkersLayer = null;
        let infrastructureLayers = {
            airports: null,
            stadiums: null,
            universities: null
        };
        let legendControl;
        
        // Track which layers are visible
        let visibleLayers = {
            heatmap: true,
            airports: false,
            stadiums: false,
            universities: false
        };
        
        // Function to get color based on growth rate
        function getColorFromGrowthRate(growthRate) {
            if (growthRate > 10) {
                return "#e74c3c"; // Red - >10%
            } else if (growthRate >= 7) {
                return "#f39c12"; // Orange - 7-10%
            } else if (growthRate >= 4) {
                return "#f1c40f"; // Yellow - 4-7%
            } else {
                return "#2ecc71"; // Green - <4%
            }
        }
        
        // Toggle infrastructure layers
        function toggleLayer(layerType) {
            const btn = event.target;
            visibleLayers[layerType] = !visibleLayers[layerType];
            
            if (visibleLayers[layerType]) {
                btn.classList.add('active');
                
                if (layerType === 'heatmap') {
                    if (heatmapLayer) map.addLayer(heatmapLayer);
                } else if (infrastructureLayers[layerType]) {
                    map.addLayer(infrastructureLayers[layerType]);
                }
            } else {
                btn.classList.remove('active');
                
                if (layerType === 'heatmap') {
                    if (heatmapLayer) map.removeLayer(heatmapLayer);
                } else if (infrastructureLayers[layerType]) {
                    map.removeLayer(infrastructureLayers[layerType]);
                }
            }
        }
        
        // Initialize map centered on Florida
        function initMap() {
            map = L.map('map', {
                center: [28.5, -82],
                zoom: 7,
                minZoom: 6,
                maxZoom: 11
            });
            
            // Add base map
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap contributors ¬© CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            
            // Add legend
            legendControl = L.control({position: 'bottomright'});
            legendControl.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <h4>üìä Growth Rate (2035-2045)</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #e74c3c;"></span>
                        <span>&gt;10% Highest</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #f39c12;"></span>
                        <span>7-10% High</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #f1c40f;"></span>
                        <span>4-7% Moderate</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #2ecc71;"></span>
                        <span>&lt;4% Lower</span>
                    </div>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
                    <h4>üèóÔ∏è Infrastructure</h4>
                    <div class="legend-item">
                        <span style="font-size: 20px;">‚úàÔ∏è</span>
                        <span style="margin-left: 10px;">Airports</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 20px;">üèüÔ∏è</span>
                        <span style="margin-left: 10px;">Stadiums (60k+)</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 20px;">üè¢</span>
                        <span style="margin-left: 10px;">Arenas</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 20px;">üéì</span>
                        <span style="margin-left: 10px;">Universities</span>
                    </div>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
                    <div class="legend-item">
                        <span class="gto-indicator">‚òÖ GTO</span>
                        <span style="margin-left: 10px; font-weight: 600;">Target Region</span>
                    </div>
                `;
                return div;
            };
            legendControl.addTo(map);
            
            // Load infrastructure data
            loadInfrastructure();
            
            // Load population data (using 2045 as it has the full 10-year growth calculated)
            loadPopulationData();
        }
        
        // Load infrastructure data once
        function loadInfrastructure() {
            fetch('data/Florida_infrastructure.geojson')
                .then(response => response.json())
                .then(data => {
                    console.log('Infrastructure data loaded:', data.features.length, 'features');
                    
                    // Create separate layers for each type
                    const airports = data.features.filter(f => f.properties.type === 'airport');
                    const stadiums = data.features.filter(f => f.properties.type === 'stadium');
                    const universities = data.features.filter(f => f.properties.type === 'university');
                    
                    // Create airport layer
                    infrastructureLayers.airports = L.geoJSON(airports, {
                        pointToLayer: (feature, latlng) => {
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: '<div style="font-size: 24px;">‚úàÔ∏è</div>',
                                    iconSize: [30, 30]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">‚òÖ GTO</span><br>' : '';
                            layer.bindPopup(`
                                ${gtoLabel}
                                <strong style="font-size: 16px;">‚úàÔ∏è ${props.name}</strong><br>
                                <strong>Code:</strong> ${props.code}<br>
                                <strong>Type:</strong> ${props.size}
                            `);
                        }
                    });
                    
                    // Create stadium layer
                    infrastructureLayers.stadiums = L.geoJSON(stadiums, {
                        pointToLayer: (feature, latlng) => {
                            const icon = feature.properties.capacity > 60000 ? 'üèüÔ∏è' : 'üè¢';
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: `<div style="font-size: 24px;">${icon}</div>`,
                                    iconSize: [30, 30]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">‚òÖ GTO</span><br>' : '';
                            const olympicReady = props.olympic_ready ? '<br><strong style="color: #27ae60;">‚úì Olympic-Ready Venue</strong>' : '';
                            layer.bindPopup(`
                                ${gtoLabel}
                                <strong style="font-size: 16px;">${props.icon} ${props.name}</strong><br>
                                <strong>Location:</strong> ${props.location}<br>
                                <strong>Capacity:</strong> ${props.capacity.toLocaleString()}<br>
                                <strong>Type:</strong> ${props.stadium_type}${olympicReady}
                            `);
                        }
                    });
                    
                    // Create university layer
                    infrastructureLayers.universities = L.geoJSON(universities, {
                        pointToLayer: (feature, latlng) => {
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: '<div style="font-size: 24px;">üéì</div>',
                                    iconSize: [30, 30]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">‚òÖ GTO</span><br>' : '';
                            layer.bindPopup(`
                                ${gtoLabel}
                                <strong style="font-size: 16px;">üéì ${props.name}</strong><br>
                                <strong>Location:</strong> ${props.location}<br>
                                <strong>Students:</strong> ${props.students.toLocaleString()}<br>
                                <strong>Potential:</strong> Olympic Village Site
                            `);
                        }
                    });
                    
                    console.log('Infrastructure layers created');
                })
                .catch(error => {
                    console.error('Error loading infrastructure:', error);
                });
        }
        
        // Load population data
        function loadPopulationData() {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            // Load GeoJSON (use 2045 data which includes growth calculations)
            fetch('data/Florida_heatmap_2045.geojson')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Loaded population data:', data.features.length, 'counties');
                    
                    // Create heatmap points
                    const heatPoints = data.features.map(f => {
                        const coords = f.geometry.coordinates;
                        const growthRate = f.properties.growth_rate;
                        
                        let intensity;
                        if (growthRate > 10) {
                            intensity = 1.0;
                        } else if (growthRate >= 7) {
                            intensity = 0.75;
                        } else if (growthRate >= 4) {
                            intensity = 0.5;
                        } else {
                            intensity = 0.25;
                        }
                        
                        return [coords[1], coords[0], intensity];
                    });
                    
                    // Create heatmap layer
                    heatmapLayer = L.heatLayer(heatPoints, {
                        radius: 50,
                        blur: 35,
                        maxZoom: 10,
                        max: 1.0,
                        gradient: {
                            0.0: '#2ecc71',
                            0.25: '#2ecc71',
                            0.5: '#f1c40f',
                            0.75: '#f39c12',
                            1.0: '#e74c3c'
                        }
                    }).addTo(map);
                    
                    // Add county markers (always visible)
                    countyMarkersLayer = L.geoJSON(data, {
                        pointToLayer: (feature, latlng) => {
                            const isGTO = feature.properties.is_gto;
                            const growthRate = feature.properties.growth_rate;
                            const fillColor = getColorFromGrowthRate(growthRate);
                            
                            return L.circleMarker(latlng, {
                                radius: isGTO ? 12 : 6,
                                fillColor: fillColor,
                                color: isGTO ? "#8B0000" : "#2c3e50",
                                weight: isGTO ? 4 : 1,
                                opacity: 1,
                                fillOpacity: isGTO ? 0.95 : 0.75
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">‚òÖ GTO TRIANGLE</span><br><br>' : '';
                            
                            layer.bindPopup(`
                                ${gtoLabel}
                                <strong style="font-size: 16px; color: #2c3e50;">${props.county} County</strong><br>
                                <hr style="margin: 8px 0; border: none; border-top: 1px solid #ddd;">
                                <strong>2045 Population:</strong><br>
                                <span style="font-size: 18px; color: #e74c3c; font-weight: 700;">${props.population.toLocaleString()}</span> people<br>
                                <br>
                                <strong>10-Year Growth (2035-2045):</strong><br>
                                <span style="font-size: 16px; color: ${getColorFromGrowthRate(props.growth_rate)}; font-weight: 700;">+${props.growth_rate}%</span>
                            `, {
                                maxWidth: 300
                            });
                        }
                    }).addTo(map);
                    
                    // Hide loading
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    document.getElementById('loading').innerHTML = '‚ùå Error loading data. Check console for details.';
                    document.getElementById('loading').style.background = '#e74c3c';
                    document.getElementById('loading').style.color = 'white';
                });
        }
        
        // Initialize map on page load
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>