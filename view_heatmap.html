<!DOCTYPE html>
<html>
<head>
    <title>Florida GTO Olympic Bid - Strategic Analysis</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #FFFFFF;
            min-height: 100vh;
            color: #0B2239;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            background: #FFFFFF;
            padding: 48px 64px;
            border-bottom: 1px solid #D9D9D9;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .header-top {
            display: flex;
            align-items: flex-start;
            margin-bottom: 32px;
        }
        
        .vertical-accent {
            width: 2px;
            height: 60px;
            background: #0B2239;
            margin-right: 24px;
        }
        
        .header-content {
            flex: 1;
        }
        
        .header h1 {
            color: #0B2239;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }
        
        .header p {
            color: #4A4A4A;
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .header .insight {
            color: #004A7C;
            font-size: 18px;
            font-weight: 500;
            margin-top: 16px;
            line-height: 1.4;
        }
        
        .controls {
            margin-top: 24px;
        }
        
        .control-label {
            font-size: 13px;
            color: #5C5C5C;
            margin-bottom: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        .layer-toggles {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .toggle-btn {
            background: #F8F9FA;
            color: #333333;
            border: 1px solid #D9D9D9;
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        
        .toggle-btn:hover {
            background: #F2F2F2;
            border-color: #B0B7BD;
        }
        
        .toggle-btn.active {
            background: #004A7C;
            color: #FFFFFF;
            border-color: #004A7C;
        }
        
        .toggle-btn.active::before {
            content: '‚úì ';
            margin-right: 4px;
        }
        
        .map-container {
            position: relative;
            height: calc(100vh - 280px);
            margin: 0;
            background: #F8F9FA;
        }
        
        #map { 
            height: 100%;
            width: 100%;
        }
        
        .legend {
            background: #FFFFFF;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            line-height: 1.4;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #D9D9D9;
        }
        
        .legend h4 {
            color: #0B2239;
            font-size: 18px;
            margin-bottom: 16px;
            font-weight: 500;
            padding-bottom: 12px;
            border-bottom: 1px solid #D9D9D9;
            letter-spacing: 0.3px;
        }
        
        .legend-section {
            margin-bottom: 20px;
        }
        
        .legend-section:last-child {
            margin-bottom: 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 12px;
            border: 1px solid #D9D9D9;
        }
        
        .legend-line {
            width: 32px;
            height: 3px;
            margin-right: 12px;
            border-radius: 2px;
        }
        
        .legend-text {
            color: #333333;
            font-size: 12px;
            font-weight: 400;
        }
        
        .gto-indicator {
            background: #004A7C;
            color: #FFFFFF;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .legend-divider {
            height: 1px;
            background: #E0E0E0;
            margin: 16px 0;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 32px 48px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #D9D9D9;
            display: none;
            z-index: 10000;
            font-size: 14px;
            color: #0B2239;
            font-weight: 400;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* Custom Popup Styling with Images - COMPACT VERSION */
        .leaflet-popup-content-wrapper {
            border-radius: 6px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            border: 1px solid #D9D9D9;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            padding: 0;
            max-width: 280px;
        }
        
        .leaflet-popup-content {
            margin: 0;
            font-size: 11px;
            line-height: 1.5;
            color: #333333;
        }
        
        .popup-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px 6px 0 0;
            display: block;
        }
        
        .popup-body {
            padding: 12px;
        }
        
        .leaflet-popup-content strong {
            color: #0B2239;
            font-weight: 500;
            font-size: 13px;
        }
        
        .popup-metric {
            color: #004A7C;
            font-size: 18px;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .popup-label {
            color: #5C5C5C;
            font-size: 9px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="vertical-accent"></div>
                <div class="header-content">
                    <h1>Florida GTO Triangle Olympic Corridor Analysis</h1>
                    <p>Strategic Infrastructure & Population Growth Assessment</p>
                    <p class="insight">Corridor demonstrates fiscally controlled, schedule-feasible Olympic execution with state coordination</p>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-label">INTERACTIVE LAYERS</div>
                <div class="layer-toggles">
                    <button class="toggle-btn active" onclick="toggleLayer('heatmap')">Growth Heatmap</button>
                    <button class="toggle-btn" onclick="toggleLayer('highways')">Highway Network</button>
                    <button class="toggle-btn" onclick="toggleLayer('airports')">Airports</button>
                    <button class="toggle-btn" onclick="toggleLayer('stadiums')">Venues & Stadiums</button>
                    <button class="toggle-btn" onclick="toggleLayer('universities')">Olympic Village Sites</button>
                </div>
            </div>
            
            <div class="source-note">
                Source: BEBR Florida Population Projections 2035-2045 | FDOT Transportation Network | Analysis Period: 2035-2045
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="loading" id="loading">Loading analysis data</div>
        </div>
    </div>
    
    <script>
        let map;
        let heatmapLayer = null;
        let countyMarkersLayer = null;
        let highwayLayer = null;
        let infrastructureLayers = {
            airports: null,
            stadiums: null,
            universities: null
        };
        let legendControl;
        
        // Track which layers are visible
        let visibleLayers = {
            heatmap: true,
            highways: false,
            airports: false,
            stadiums: false,
            universities: false
        };
        
        // Image mapping for venues, airports, and universities
        const imageMapping = {
            venues: {
                'Ben Hill Griffin Stadium': 'images/ben-hill.jpg',
                'Raymond James Stadium': 'images/raymond-james.jpg',
                'Camping World Stadium': 'images/camping-world.jpg',
                'Amway Center': 'images/amway.avif',
                'Amalie Arena': 'images/amalie.jpg',
                'O\'Connell Center': 'images/oconnell.jpg',
                'Orange County Convention': 'images/orange-convention.jpg',
                'TPC Sawgrass': 'images/tpc-sawgrass.jpg',
                'UF Aquatic Center': 'images/uf-aquatic.jpg',
                'Hard Rock Stadium': 'images/HardRock.webp'
            },
            airports: {
                'Orlando International Airport': 'images/mco.jpg',
                'Tampa International Airport': 'images/tpa.jpg',
                'Gainesville Regional Airport': 'images/gnv.jpg',
                'Miami International Airport': 'images/miami.png',
                'Fort Lauderdale-Hollywood': 'images/fll.jpg',
                'Jacksonville International': 'images/jax.avif'
            },
            universities: {
                'University of Florida': 'images/uf.jpg',
                'University of Central Florida': 'images/ucf.avif',
                'University of South Florida': 'images/usf.jpg'
            }
        };
        
        // Function to get color based on growth rate (using design system colors)
        function getColorFromGrowthRate(growthRate) {
            if (growthRate > 10) {
                return "#004A7C"; // Primary accent - highest growth
            } else if (growthRate >= 7) {
                return "#3498db"; // Medium blue
            } else if (growthRate >= 4) {
                return "#B0B7BD"; // Secondary neutral
            } else {
                return "#D9D9D9"; // Light gray
            }
        }
        
        // Toggle infrastructure layers
        function toggleLayer(layerType) {
            const btn = event.target;
            visibleLayers[layerType] = !visibleLayers[layerType];
            
            if (visibleLayers[layerType]) {
                btn.classList.add('active');
                
                if (layerType === 'heatmap') {
                    if (heatmapLayer) map.addLayer(heatmapLayer);
                } else if (layerType === 'highways') {
                    if (highwayLayer) map.addLayer(highwayLayer);
                } else if (infrastructureLayers[layerType]) {
                    map.addLayer(infrastructureLayers[layerType]);
                }
            } else {
                btn.classList.remove('active');
                
                if (layerType === 'heatmap') {
                    if (heatmapLayer) map.removeLayer(heatmapLayer);
                } else if (layerType === 'highways') {
                    if (highwayLayer) map.removeLayer(highwayLayer);
                } else if (infrastructureLayers[layerType]) {
                    map.removeLayer(infrastructureLayers[layerType]);
                }
            }
        }
        
        // Initialize map centered on Florida
        function initMap() {
            map = L.map('map', {
                center: [28.5, -82],
                zoom: 7,
                minZoom: 6,
                maxZoom: 11
            });
            
            // Add base map (light, clean style)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap contributors ¬© CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            
            // Add legend with design system styling
            legendControl = L.control({position: 'bottomright'});
            legendControl.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div class="legend-section">
                        <h4>Population Growth Rate (2035-2045)</h4>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #004A7C;"></span>
                            <span class="legend-text">>10% ‚Äî Highest Growth</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #3498db;"></span>
                            <span class="legend-text">7‚Äì10% ‚Äî High Growth</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #B0B7BD;"></span>
                            <span class="legend-text">4‚Äì7% ‚Äî Moderate Growth</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #D9D9D9;"></span>
                            <span class="legend-text"><4% ‚Äî Lower Growth</span>
                        </div>
                    </div>
                    
                    <div class="legend-divider"></div>
                    
                    <div class="legend-section">
                        <h4>Infrastructure Assets</h4>
                        <div class="legend-item">
                            <span class="legend-line" style="background: #004A7C;"></span>
                            <span class="legend-text">Major Highway Corridor</span>
                        </div>
                        <div class="legend-item">
                            <span style="font-size: 16px;">‚úàÔ∏è</span>
                            <span class="legend-text" style="margin-left: 8px;">Regional Airport</span>
                        </div>
                        <div class="legend-item">
                            <span style="font-size: 16px;">üèüÔ∏è</span>
                            <span class="legend-text" style="margin-left: 8px;">Major Stadium (60k+ capacity)</span>
                        </div>
                        <div class="legend-item">
                            <span style="font-size: 16px;">üè¢</span>
                            <span class="legend-text" style="margin-left: 8px;">Arena Venue</span>
                        </div>
                        <div class="legend-item">
                            <span style="font-size: 16px;">üéì</span>
                            <span class="legend-text" style="margin-left: 8px;">University (Olympic Village Site)</span>
                        </div>
                    </div>
                    
                    <div class="legend-divider"></div>
                    
                    <div class="legend-item">
                        <span class="gto-indicator">GTO</span>
                        <span class="legend-text" style="margin-left: 8px; font-weight: 500;">Target Corridor Asset</span>
                    </div>
                `;
                return div;
            };
            legendControl.addTo(map);
            
            // Load all data
            loadHighways();
            loadInfrastructure();
            loadPopulationData();
        }
        
        // Load highway data
        function loadHighways() {
            fetch('data/Florida_highways.geojson')
                .then(response => response.json())
                .then(data => {
                    console.log('Highway data loaded:', data.features.length, 'routes');
                    
                    highwayLayer = L.geoJSON(data, {
                        style: function(feature) {
                            return {
                                color: feature.properties.is_gto ? '#004A7C' : '#B0B7BD',
                                weight: feature.properties.is_gto ? 4 : 2,
                                opacity: feature.properties.is_gto ? 0.9 : 0.5,
                                dashArray: feature.properties.is_gto ? null : '5, 5'
                            };
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">GTO</span><br><br>' : '';
                            layer.bindPopup(`
                                <div class="popup-body">
                                    ${gtoLabel}
                                    <strong style="font-size: 14px;">${props.name}</strong><br>
                                    <span style="color: #5C5C5C; font-size: 12px;">${props.description}</span>
                                </div>
                            `);
                        }
                    });
                    
                    console.log('Highway layer created');
                })
                .catch(error => {
                    console.error('Error loading highways:', error);
                });
        }
        
        // Load infrastructure data
        function loadInfrastructure() {
            fetch('data/Florida_infrastructure.geojson')
                .then(response => response.json())
                .then(data => {
                    console.log('Infrastructure data loaded:', data.features.length, 'features');
                    
                    const airports = data.features.filter(f => f.properties.type === 'airport');
                    const stadiums = data.features.filter(f => f.properties.type === 'stadium');
                    const universities = data.features.filter(f => f.properties.type === 'university');
                    
                    // Olympic requirements descriptions for airports
                    const airportRequirements = {
                        'Orlando International Airport': 'IOC requires 40M+ annual passengers. MCO serves 50M annually, exceeding requirements. Primary gateway for international delegations and media.',
                        'Tampa International Airport': 'Serves 22M passengers annually. Provides western corridor access for Tampa Bay region events. Ranked #1 U.S. airport for passenger experience.',
                        'Gainesville Regional Airport': 'Regional hub serving 1.2M passengers. Direct access to University of Florida Olympic Village and Opening/Closing Ceremony venue.',
                        'Miami International Airport': 'Secondary gateway with 46M annual passengers. Provides South Florida contingency capacity and Latin American delegation access.',
                        'Fort Lauderdale-Hollywood': 'Supplemental international hub (36M passengers). Alleviates Miami congestion during peak Olympic arrival periods.',
                        'Jacksonville International': '6M annual passengers. Provides northern corridor access and contingency routing for golf venues.'
                    };
                    
                    // Olympic requirements descriptions for venues
                    const venueRequirements = {
                        'Ben Hill Griffin Stadium': 'IOC requires 80,000+ seat stadium for Opening/Closing Ceremonies. "The Swamp" provides 88,548 capacity with modern amenities, broadcast infrastructure, and integrated medical facilities. Also hosts Track & Field finals.',
                        'Raymond James Stadium': 'Primary Soccer venue with 65,618 capacity. Recent Super Bowl host (2021) demonstrates Olympic-ready broadcast and security infrastructure. FIFA-compliant field dimensions.',
                        'Camping World Stadium': 'Secondary Soccer venue (65,438 capacity). Renovated 2014-2017 with $207M investment. Hosts Rugby Sevens competition. Central Orlando location minimizes athlete travel.',
                        'Amway Center': 'IOC requires 18,000+ seat arena for Basketball. Provides 18,846 capacity with NBA-grade facilities. Hosted 2012 NBA All-Star Game. Modern broadcast center and athlete amenities.',
                        'Amalie Arena': 'Ice Hockey and Figure Skating venue (19,092 capacity). NHL Tampa Bay Lightning home arena with Olympic ice specifications. Convertible floor for multiple sports.',
                        'O\'Connell Center': 'Gymnastics and Volleyball venue (10,500 capacity). University of Florida arena with recent $64M renovation. Existing Olympic training facilities on campus.',
                        'Orange County Convention': 'IOC requires 200,000+ sq ft for Fencing, Wrestling, Boxing, and Taekwondo. Provides 2.1M sq ft with modular layout. Broadcast Center location allows rapid media access.',
                        'TPC Sawgrass': 'Olympic Golf venue hosting PGA Tour\'s THE PLAYERS Championship. Stadium Course meets IOC specifications with 18,000+ spectator capacity. Proven international broadcast infrastructure.',
                        'UF Aquatic Center': 'Olympic Swimming, Diving, and Water Polo venue. 50-meter competition pool with FINA specifications. Adjacent diving well and warm-up pools. University medical facilities on-site.',
                        'Hard Rock Stadium': 'Contingency venue (65,326 capacity) and preliminary Soccer matches. Recent $550M renovation. Retractable canopy protects from Florida weather. Hosted Super Bowl LIV (2020).'
                    };
                    
                    // Olympic requirements descriptions for universities
                    const universityRequirements = {
                        'University of Florida': 'Primary Olympic Village (12,000+ beds). IOC requires integrated dining, medical, and training facilities ‚Äî UF provides on-campus hospital, athlete training center, and 10 dining halls. 55,000 students ensure post-Olympic housing demand.',
                        'University of Central Florida': 'Secondary Village (11,000+ beds) serving Orlando metro venues. Nation\'s second-largest university with extensive recreation facilities. 15-minute drive to Amway Center and Convention Center broadcast hub.',
                        'University of South Florida': 'Tertiary Village (7,000+ beds) for Tampa region athletes. Adjacent to USF Health Morsani College of Medicine. 20-minute drive to Raymond James Stadium and Amalie Arena.'
                    };
                    
                    // Create airport layer with images and requirements
                    infrastructureLayers.airports = L.geoJSON(airports, {
                        pointToLayer: (feature, latlng) => {
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: '<div style="font-size: 22px;">‚úàÔ∏è</div>',
                                    iconSize: [28, 28]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const imagePath = imageMapping.airports[props.name];
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">GTO</span>' : '';
                            const requirement = airportRequirements[props.name] || 'Provides regional air connectivity for Olympic operations.';
                            
                            const imageHtml = imagePath ? `<img src="${imagePath}" class="popup-image" alt="${props.name}" onerror="this.style.display='none'">` : '';
                            
                            layer.bindPopup(`
                                ${imageHtml}
                                <div class="popup-body">
                                    ${gtoLabel ? gtoLabel + '<br><br>' : ''}
                                    <strong style="font-size: 16px;">‚úàÔ∏è ${props.name}</strong><br>
                                    <div class="popup-label">AIRPORT CODE</div>
                                    <div style="color: #004A7C; font-weight: 600; font-size: 18px;">${props.code}</div>
                                    <div class="popup-label">ANNUAL PASSENGERS</div>
                                    <div style="color: #333333; font-weight: 500;">${props.size}</div>
                                    <div class="popup-label" style="margin-top: 12px;">OLYMPIC REQUIREMENT ALIGNMENT</div>
                                    <div style="color: #333333; font-size: 12px; line-height: 1.5; background: #F8F9FA; padding: 10px; border-radius: 6px; margin-top: 4px;">
                                        ${requirement}
                                    </div>
                                </div>
                            `, {
                                maxWidth: 380,
                                className: 'custom-popup'
                            });
                        }
                    });
                    
                    // Create stadium layer with images and requirements
                    infrastructureLayers.stadiums = L.geoJSON(stadiums, {
                        pointToLayer: (feature, latlng) => {
                            const icon = feature.properties.capacity > 60000 ? 'üèüÔ∏è' : 'üè¢';
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: `<div style="font-size: 22px;">${icon}</div>`,
                                    iconSize: [28, 28]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const imagePath = imageMapping.venues[props.name];
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">GTO</span>' : '';
                            const olympicReady = props.olympic_ready ? '<div style="color: #27ae60; font-weight: 500; margin-top: 8px;">‚úì Olympic-Ready Venue</div>' : '';
                            const requirement = venueRequirements[props.name] || 'Meets IOC venue standards for Olympic competition.';
                            
                            const imageHtml = imagePath ? `<img src="${imagePath}" class="popup-image" alt="${props.name}" onerror="this.style.display='none'">` : '';
                            
                            layer.bindPopup(`
                                ${imageHtml}
                                <div class="popup-body">
                                    ${gtoLabel ? gtoLabel + '<br><br>' : ''}
                                    <strong style="font-size: 16px;">${props.name}</strong><br>
                                    <div style="color: #5C5C5C; font-size: 12px; margin-top: 4px;">${props.location}</div>
                                    <div class="popup-label">CAPACITY</div>
                                    <div class="popup-metric">${props.capacity.toLocaleString()}</div>
                                    <div class="popup-label">VENUE TYPE</div>
                                    <div style="color: #333333;">${props.stadium_type}</div>
                                    ${olympicReady}
                                    <div class="popup-label" style="margin-top: 12px;">OLYMPIC REQUIREMENT ALIGNMENT</div>
                                    <div style="color: #333333; font-size: 12px; line-height: 1.5; background: #F8F9FA; padding: 10px; border-radius: 6px; margin-top: 4px;">
                                        ${requirement}
                                    </div>
                                </div>
                            `, {
                                maxWidth: 400,
                                className: 'custom-popup'
                            });
                        }
                    });
                    
                    // Create university layer with images and requirements
                    infrastructureLayers.universities = L.geoJSON(universities, {
                        pointToLayer: (feature, latlng) => {
                            return L.marker(latlng, {
                                icon: L.divIcon({
                                    className: 'custom-icon',
                                    html: '<div style="font-size: 22px;">üéì</div>',
                                    iconSize: [28, 28]
                                })
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const imagePath = imageMapping.universities[props.name];
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">GTO</span>' : '';
                            const requirement = universityRequirements[props.name] || 'Provides athlete accommodation with integrated dining and medical facilities.';
                            
                            const imageHtml = imagePath ? `<img src="${imagePath}" class="popup-image" alt="${props.name}" onerror="this.style.display='none'">` : '';
                            
                            layer.bindPopup(`
                                ${imageHtml}
                                <div class="popup-body">
                                    ${gtoLabel ? gtoLabel + '<br><br>' : ''}
                                    <strong style="font-size: 16px;">üéì ${props.name}</strong><br>
                                    <div style="color: #5C5C5C; font-size: 12px; margin-top: 4px;">${props.location}</div>
                                    <div class="popup-label">ENROLLMENT</div>
                                    <div class="popup-metric">${props.students.toLocaleString()}</div>
                                    <div class="popup-label">OLYMPIC ROLE</div>
                                    <div style="color: #004A7C; font-weight: 500;">Olympic Village Site</div>
                                    <div class="popup-label" style="margin-top: 12px;">OLYMPIC REQUIREMENT ALIGNMENT</div>
                                    <div style="color: #333333; font-size: 12px; line-height: 1.5; background: #F8F9FA; padding: 10px; border-radius: 6px; margin-top: 4px;">
                                        ${requirement}
                                    </div>
                                </div>
                            `, {
                                maxWidth: 400,
                                className: 'custom-popup'
                            });
                        }
                    });
                    
                    console.log('Infrastructure layers created');
                })
                .catch(error => {
                    console.error('Error loading infrastructure:', error);
                });
        }
        
        // Load population data
        function loadPopulationData() {
            document.getElementById('loading').style.display = 'block';
            
            fetch('data/Florida_heatmap_2045.geojson')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Loaded population data:', data.features.length, 'counties');
                    
                    // Create heatmap points
                    const heatPoints = data.features.map(f => {
                        const coords = f.geometry.coordinates;
                        const growthRate = f.properties.growth_rate;
                        
                        let intensity;
                        if (growthRate > 10) {
                            intensity = 1.0;
                        } else if (growthRate >= 7) {
                            intensity = 0.7;
                        } else if (growthRate >= 4) {
                            intensity = 0.4;
                        } else {
                            intensity = 0.2;
                        }
                        
                        return [coords[1], coords[0], intensity];
                    });
                    
                    // Create heatmap layer with design system colors
                    heatmapLayer = L.heatLayer(heatPoints, {
                        radius: 50,
                        blur: 35,
                        maxZoom: 10,
                        max: 1.0,
                        gradient: {
                            0.0: '#D9D9D9',
                            0.2: '#D9D9D9',
                            0.4: '#B0B7BD',
                            0.7: '#3498db',
                            1.0: '#004A7C'
                        }
                    }).addTo(map);
                    
                    // Add county markers
                    countyMarkersLayer = L.geoJSON(data, {
                        pointToLayer: (feature, latlng) => {
                            const isGTO = feature.properties.is_gto;
                            const growthRate = feature.properties.growth_rate;
                            const fillColor = getColorFromGrowthRate(growthRate);
                            
                            return L.circleMarker(latlng, {
                                radius: isGTO ? 10 : 5,
                                fillColor: fillColor,
                                color: isGTO ? "#0B2239" : "#333333",
                                weight: isGTO ? 3 : 1,
                                opacity: 1,
                                fillOpacity: 0.85
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            const gtoLabel = props.is_gto ? '<span class="gto-indicator">GTO CORRIDOR</span><br><br>' : '';
                            
                            layer.bindPopup(`
                                <div class="popup-body">
                                    ${gtoLabel}
                                    <strong style="font-size: 15px; color: #0B2239;">${props.county} County</strong><br>
                                    <div style="margin-top: 12px;">
                                        <div class="popup-label">2045 POPULATION</div>
                                        <div class="popup-metric">${props.population.toLocaleString()}</div>
                                    </div>
                                    <div style="margin-top: 12px;">
                                        <div class="popup-label">10-YEAR GROWTH (2035-2045)</div>
                                        <div style="color: ${getColorFromGrowthRate(props.growth_rate)}; font-size: 20px; font-weight: 700;">+${props.growth_rate}%</div>
                                    </div>
                                </div>
                            `, {
                                maxWidth: 280
                            });
                        }
                    }).addTo(map);
                    
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    document.getElementById('loading').innerHTML = '‚ùå Error loading data';
                    document.getElementById('loading').style.color = '#0B2239';
                });
        }
        
        // Initialize map on page load
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>